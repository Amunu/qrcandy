<% include _partial/header.ejs %>
  <div style="padding-top: 19px" class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1">
    <div class="jumbotron box">
      <h2>个人信息</h2>
      <div class="row" style="margin-top:30px;">
        <div class="col-md-3 col-md-offset-1">
          <div class="row">
            <div class="col-md-12">
              <div class="img-responsive" style="border-radius:10px;"></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <ul class="list-unstyled">
            <li>
              <h3><%= username %></h3>
            </li>
            <li>邮箱：<%= user.email %></li>
            <li>注册时间 : <%= user.reg_time %></li>
          </ul>
        </div>
        <div class="col-md-4">
          <ul class="list-unstyled" style="margin-top:10px">
            <li>
              <%= username %> 有<span style="font-size:34px;" class="info"><%= data.data.length %></span>个二维码
            </li>
            <li><span style="font-size:34px;" class="info"><%= data.data.length %></span>个活码</li>
          </ul>
        </div>
    </div>
    </div>
    <table class="table table-striped table-hover box">
      <thead>
        <tr>
          <th>类型</th>
          <th>创建时间</th>
          <th>内容</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
    <div style=" margin-left: auto; margin-right: auto;">
      <nav>
        <ul class="pagination">
        </ul>
      </nav>
    </div>
  </div>

  <style type="text/css">
    .list-unstyled {
      font-size: 18px;
    }
    .info-number {
      font-family: Constantia,Georgia;
    }
    .box {
      border-radius: 3px;
      box-shadow: 0px 2px 3px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid #e2e2e2;
    }
  </style>

  <script>
    $(function() {
      var str = "<%= hash %>";
      var url = "<img src='http://www.gravatar.com/avatar/" + str + "?s=150' />";
      $(".img-responsive").append(url);
      if(<%= data.pages %>) {
        var page = 1;
        var pages = <%= data.pages %>;

        if(<%= _page  %> - 1 > 0) {
          var url = '/user/' + _page;
          var _page = <%= _page %> - 1;
          console.log('---', _page);
          $(".pagination").append("<li><a href='/user/<%= _page - 1 %>'>&laquo;</a></li>");
        }

        while(page <= pages) {
          $(".pagination").append("<li><a href='/user/" + page + "'>" + page + "</a></li>");
          page ++;
        }

        $("[href$='/user/<%= _page %>']").parent().addClass('active');

        if(parseInt(<%= _page  %>) + 1 <= pages) {
          $(".pagination").append("<li><a href='/user/<%= parseInt(_page) + 1 %>'>&raquo;</a></li>");
        }
      }

      if(<%= data.data.length %>) {
        var data = <%- JSON.stringify(data.data) %> ;
        data.forEach(function(qrcode) {
          if(qrcode.info.length > 30) qrcode.info = qrcode.info.substr(0,27) + '...';
          $("tbody").append(
            "<tr><td>" + qrcode.type +
            "</td><td>" + qrcode.created_at +
            "</td><td>" + qrcode.info +
            "</td><td><a href = '#' rel='" + qrcode.qrcode_id + "'><span class='glyphicon glyphicon-qrcode'></span> 二维码 </a>" +
            "<a href = '#' activeid = '" + qrcode.qrcode_id + "' style='padding-left: 10px'><span class='glyphicon glyphicon-pencil'></span>编辑</a>" +
            "<a href = '#' activeid = '" + qrcode.qrcode_id + "' style='padding-left: 10px'><span class='glyphicon glyphicon-trash'></span> 删除  </a></td></tr>");

          $("[rel=" + qrcode.qrcode_id + "]").popover({
            trigger : 'manual',
            placement : 'right',
            title : '唯一ID: ' + qrcode.qrcode_id,
            html : 'true',
            content : "<img src='http://qrcandy.b0.upaiyun.com/<%= username%>/" + qrcode.qrcode_id + "'>",
            animation : 'false'
          }).on('mouseenter', function() {
            var _this = this;
            $(this).popover("show");
            $(this).siblings(".popover").on("mouseleave", function(){
              $(_this).popover('hide');
            });
          }).on("mouseleave", function(){
            var _this = this;
            setTimeout(function() {
              if(!$(".popover:hover").length) {
                $(_this).popover("hide");
              }
            }, 100);
          });
        });
      }

      $(".user").addClass('active');
    });
  </script>
<% include _partial/footer.ejs %>
